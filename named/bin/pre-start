#!/usr/bin/env bash
var1=${@}

__RESOLVE_FILE__=/etc/resolv.conf

function copy_systemd_resoved
{
  cp Docker/files/etc/systemd/resolved.conf /etc/systemd/resolved.conf
}

function remove_google
{
  sed -i '/nameserver 8.8.8.8/d' /etc/resolv.conf
}

function update_domain
{
  echo "domain ${1}" >> ${__RESOLVE_FILE__}
}

function update_searchlist
{
  echo "Adding search list"
  echo "search ${@}" >> ${__RESOLVE_FILE__}
}

function start_docker
{
  sudo systemctl enable docker
  sudo systemctl restart docker
}

function setup_interface() {
  echo ${__INTERFACE__}
  sudo ifconfig ${__INTERFACE__}:0 10.55.55.2 netmask 255.255.255.0 up
}

setup_interface
remove_google
copy_systemd_resoved

cat <<__EOD__

  Processing Domains

  ${var1[@]}

__EOD__


for item in ${var1[@]}
do
  echo "Checking ${item}"
  egrep "domain ${item}" ${__RESOLVE_FILE__} ||  update_domain "${item}"
done

egrep "search ${var1[@]}" ${__RESOLVE_FILE__} || update_searchlist ${var1[@]}

printf "\n\n${__RESOLVE_FILE__}\n"
cat ${__RESOLVE_FILE__}

cat <<__EOD__

Finished

__EOD__


../bin/docker-status ; [ ${?} -ne 0 ] && start_docker
