#!/usr/bin/env bash

source ./.env

# [ -d ${GITLAB_BACKUP} ] && sudo rsync -av ${GITLAB_BACKUP}/ ${GITLAB_HOME}

#mkdir -p /splunk/{etc,var}

#udo docker volume create --driver local \
#    --opt type=none \
#    --opt device=/splunk/etc \
#    --opt o=bind opt_splunk_etc

#sudo docker volume create --driver local \
#    --opt type=none \
#    --opt device=/splunk/var \
#    --opt o=bind opt_splunk_var

# ls -l /splunk

sudo systemctl enable docker
sudo systemctl restart docker

sleep 10

# (cd Docker && sudo -E docker build -t ${__CONTAINER_IMAGE__} .)

__INTERFACE__=$(netstat -r | awk '$1 == "10.55.55.0" {print $8}')
echo ${__INTERFACE__}
sudo ifconfig ${__INTERFACE__}:0 10.55.55.2 netmask 255.255.255.0 up
sudo systemctl stop systemd-resolv

sudo -E docker-compose up --build --remove-orphans -d
[ ! -e /etc/resolv.conf.orig_galaxy3 ] && cp /etc/resolv.conf /etc/resolv.conf.orig_galaxy3

sudo cat <<_EOD_ > /etc/resolv.conf
nameserver 10.55.55.2
nameserver 8.8.8.8
nameserver 8.8.4.4
nameserver 127.0.0.53

search modell.galaxy3.net
_EOD_


